<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Domino ‚Ä¢ Free One List</title>
<style>
  :root{
    --accent:#e6a8ff; --accent2:#ffda8b;
    --tile:#fffaf5; --tile-edge:#e2c0ff; --tile-shadow:rgba(0,0,0,.25);
    --seat-fs:14px;
    --wood:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><defs><linearGradient id='g' x1='0' y1='0' x2='0' y2='1'><stop offset='0%' stop-color='%232b1d12'/><stop offset='100%' stop-color='%2354321e'/></linearGradient><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/><feColorMatrix type='saturate' values='0.2'/><feComponentTransfer><feFuncA type='table' tableValues='0 0.08'/></feComponentTransfer></filter></defs><rect width='512' height='512' fill='url(%23g)'/><rect width='512' height='512' filter='url(%23n)' opacity='.25'/><g opacity='.35' stroke='%2329160d' stroke-width='6'><path d='M0 80h512M0 160h512M0 240h512M0 320h512M0 400h512'/></g></svg>");
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0; font:500 16px Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif; color:#fdf4ff; background:#3b281b; overflow:hidden; display:flex; align-items:center; justify-content:center;}
  #stage{position:relative; width:960px; height:540px; display:flex; flex-direction:column; align-items:center; background-image:var(--wood); background-repeat:no-repeat; background-size:cover; background-position:center; box-shadow:inset 0 0 80px rgba(0,0,0,.45), inset 0 0 140px rgba(0,0,0,.35); border-radius:12px;}
  h1{margin:8px 0 6px; font-size:24px; font-weight:900; color:#f2d39a; text-shadow:0 1px 0 #402b16,0 0 18px rgba(0,0,0,.45)}
  .menu{position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px; padding:30px; z-index:100000; background:linear-gradient(rgba(32,21,12,.92), rgba(32,21,12,.94)), var(--wood); background-repeat:no-repeat; background-size:cover; background-position:center; box-shadow:inset 0 0 80px rgba(0,0,0,.55); border-radius:12px;}
  .menu label{color:#f2d39a; font-weight:800} .menu input{padding:8px 12px; width:220px; border-radius:8px; border:2px solid #8c5c2f; background:#fff6e7; color:#2b1a10}
  .menu button{padding:10px 16px; border-radius:10px; border:2px solid #7a5525; font-weight:900; cursor:pointer; background:linear-gradient(#f1c97a,#e7b85f); color:#2b1a10}
  .topbar{width:95%; display:flex; align-items:center; justify-content:space-between; gap:10px}
  .players{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .player{padding:6px 12px; border-radius:14px; background:rgba(230,168,255,.15); font-size:12px}
  .player.active{background:#f2c56a; color:#2b1a10; font-weight:900; box-shadow:0 0 14px #f2c56a}
  .score{margin-left:4px; font-weight:900}
  .controls{display:flex; gap:8px}
  .btn{padding:8px 14px; border-radius:10px; border:2px solid #7a5525; background:linear-gradient(#f1c97a,#e7b85f); color:#2c1a32; font-weight:800}
  .btn:disabled{opacity:.6; cursor:not-allowed}
  .board{position:relative; width:95%; height:68%; margin:6px 0; background:radial-gradient(120% 100% at 50% 50%, #3c2a3e, #2e2130 70%) padding-box; border:10px solid transparent; border-radius:18px; border-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><rect width='20' height='20' fill='%2354321e'/><rect x='1' y='1' width='18' height='18' fill='none' stroke='%238c5c2f' stroke-width='1.5'/></svg>") 30 round; box-shadow:0 8px 24px rgba(0,0,0,.45), inset 0 0 18px rgba(0,0,0,.35); overflow:hidden;}
  .chain{position:relative; width:100%; height:100%}
  #chainZoom{position:absolute; inset:0; transform-origin:0 0;}
  .tile{width:200px; height:70px; background:radial-gradient(120% 120% at 20% 20%, rgba(0,0,0,.08), transparent 60%), linear-gradient(#fffdf8,#fff6e7); border:2px solid #e7dbc9; border-radius:12px; display:grid; grid-template-columns:1fr 1fr; position:absolute; box-shadow:0 2px 6px rgba(0,0,0,.35), inset 0 0 0 2px #e0d3bd, inset 0 -10px 20px rgba(0,0,0,.06); overflow:hidden; user-select:none; transition:transform .12s; -webkit-user-drag:element;}
  .tile:hover{transform:scale(1.04)}
  .tile .half{display:flex; align-items:center; justify-content:center; padding:0 8px; overflow:hidden; min-width:0;}
  .tile .half:first-child { border-right: 2px solid #d8c8aa; }
  .tile b{display:block; line-height:1.05; font-weight:900; color:#1c1712; white-space:nowrap; max-width:100%}
  .tile.hand{transform:scale(.50); transform-origin:left center; cursor:grab; filter:drop-shadow(0 1px 1px rgba(0,0,0,.25))}
  .dz{position:absolute; width:38px; height:38px; border:2px dashed #b68a3e; border-radius:10px; display:none; background:rgba(255,215,120,.08)}
  .dz.active{display:block; background:rgba(255,215,120,.28); box-shadow:0 0 16px rgba(255,215,120,.7)}
  .dz::after{content:attr(data-dir); font-size:11px; color:#2c1a32; font-weight:900; background:#f2c56a; padding:2px 6px; border-radius:8px; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%)}
  .final-overlay{position:absolute; inset:0; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:100000;}
  .final-message{font-size:48px; font-weight:900; color:#ffe97f; text-shadow:0 0 20px #ff0000, 0 0 40px #ff9900, 0 0 60px #fff; animation:pop 1s ease-out;}
  @keyframes pop{0%{transform:scale(0.2); opacity:0;}60%{transform:scale(1.2); opacity:1;}100%{transform:scale(1);} }
</style>
</head>
<body>
  <div id="menu">
    <h1>Domino ‚Ä¢ Free One List</h1>
    <label>–ò–≥—Ä–æ–∫–æ–≤: <input type="number" id="playerCount" value="2" min="2" max="4"></label>
    <div>
      <input type="text" id="pname0" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞ 1">
      <input type="text" id="pname1" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞ 2">
      <input type="text" id="pname2" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞ 3">
      <input type="text" id="pname3" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞ 4">
    </div>
    <button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>

  <div id="chainZoom"></div>
  <div id="playersBar"></div>
  <div id="handBar"></div>

  <div id="finalOverlay" class="final-overlay">
    <div class="final-message">üéâ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <span id="winnerName"></span> üéâ</div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
const TILE_W=100, TILE_H=50;
let deck=[],hands={},scores={},passes={},playerNames=[],currentPlayer=0;
let openLeft, openRight,endLeft,endRight;
let freeMode=true; // üü¢ —Å–≤–æ–±–æ–¥–Ω–∞—è –∏–≥—Ä–∞

function uid(s){return s+'_'+Math.random().toString(36).substr(2,9);}
function getQueryData(){ try{const url=new URL(window.location.href); return JSON.parse(decodeURIComponent(url.searchParams.get("data")));}catch(e){return {};} }
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

// === –ö–æ–ª–æ–¥–∞ (1 —Å–ø–∏—Å–æ–∫) ===
function buildDeckFromData(d){
  const out=[], A=(d&&Array.isArray(d.listA))?d.listA:[];
  if(A.length){
    for(let i=0;i<A.length;i++)
      for(let j=i;j<A.length;j++)
        out.push({a:A[i], b:A[j], uid:uid("A"+i+"_"+j)});
  }
  return out;
}

// === –ò–≥—Ä–∞ ===
function startGame(){
  const data=getQueryData()||{};
  playerNames.length=0;
  const c=Math.max(2,Math.min(4,parseInt(document.getElementById("playerCount").value)||2));
  for(let i=0;i<c;i++){playerNames.push((document.getElementById("pname"+i)?.value||"").trim()||("–ò–≥—Ä–æ–∫ "+(i+1)));}
  deck=buildDeckFromData(data); shuffle(deck);

  scores={}; passes={}; hands={}; currentPlayer=0;
  for(let k=0;k<c;k++){hands[k]=[];scores[k]=0;passes[k]=0;}
  for(let r=0;r<5;r++)for(let j=0;j<c;j++)if(deck.length)hands[j].push(deck.shift());

  let start=deck.shift(); if(!start)start={a:"–°—Ç–∞—Ä—Ç",b:"–°—Ç–∞—Ä—Ç",uid:uid("S")};
  chainZoom.innerHTML="";
  const sx=300,sy=200;
  const tile=createTileEl(start.a,start.b,{left:sx,top:sy});
  chainZoom.appendChild(tile);

  openLeft=start.a; openRight=start.b;
  endLeft={x:sx,y:sy,dir:-1,orient:"h",el:tile};
  endRight={x:sx,y:sy,dir:1,orient:"h",el:tile};

  renderPlayersBar(); renderHand();
  document.getElementById("menu").style.display="none";
}

function createTileEl(a,b,pos){
  const d=document.createElement("div");
  d.className="tile"; d.style.left=pos.left+"px"; d.style.top=pos.top+"px";
  d.innerHTML=`<span>${a}</span>|<span>${b}</span>`;
  return d;
}

// === –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ===
function renderPlayersBar(){
  let h=""; for(let i=0;i<playerNames.length;i++){
    h+=`<b>${playerNames[i]}</b> (${hands[i].length} –∫–æ—Å—Ç.) `;
  }
  document.getElementById("playersBar").innerHTML=h;
}
function renderHand(){
  let h=""; const arr=hands[currentPlayer]||[];
  for(const t of arr){
    h+=`<button>${t.a}|${t.b}</button>`;
  }
  document.getElementById("handBar").innerHTML=h;
}

// === –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ ===
function endByWinner(i){
  const name=playerNames[i];
  document.getElementById("winnerName").textContent=name;
  document.getElementById("finalOverlay").style.display="flex";
  const winSound=new Audio("win.mp3"); winSound.play();
  if(window.confetti){
    const duration=3*1000,end=Date.now()+duration;
    (function frame(){
      confetti({particleCount:5,angle:60,spread:55,origin:{x:0}});
      confetti({particleCount:5,angle:120,spread:55,origin:{x:1}});
      if(Date.now()<end)requestAnimationFrame(frame);
    })();
  }
}
</script>
</body>
</html>
