<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Domino ¬∑ Classic</title>

<style>
  :root{
    --accent:#e6a8ff;
    --accent2:#ffda8b;
    --tile:#fffaf5;
    --tile-edge:#e2c0ff;
    --tile-shadow:rgba(0,0,0,.25);
    --seat-fs:14px;
  }
  *{ box-sizing:border-box; }
  html, body{ height:100%; margin:0; padding:0; }

  body {
    font:500 16px Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
    color:#fdf4ff;
    background:#3b281b;
    padding:20px;         /* üî• –≤–æ–∑–¥—É—Ö –≤–æ–∫—Ä—É–≥ */
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  #stage {
    background:#2e2130;
    border-radius:20px;
    padding:20px;
    max-width:1200px;
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    box-shadow:0 0 20px rgba(0,0,0,.5);
  }

  h1{ margin:8px 0 6px; font-size:24px; font-weight:900; color:#f2d39a; }

  .menu{
    position:absolute; inset:0;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    gap:14px; padding:30px; z-index:100000;
    background:rgba(0,0,0,.8);
  }
  .menu label{ color:#f2d39a; font-weight:800; }
  .menu input{
    padding:8px 12px; width:220px; border-radius:8px;
    border:2px solid #8c5c2f; background:#fff6e7; color:#2b1a10; margin-top:4px;
  }
  .menu button{
    padding:10px 16px; border-radius:10px; border:2px solid #7a5525;
    font-weight:900; cursor:pointer;
    background:linear-gradient(#f1c97a,#e7b85f); color:#2b1a10;
  }

  .topbar {
    width:100%;
    display:flex; align-items:center; justify-content:space-between;
    gap:10px; padding:10px 20px;
  }

  .players{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .player{ padding:6px 12px; border-radius:14px; background:rgba(230,168,255,.15); font-size:12px; }
  .player.active{ background:#f2c56a; color:#2b1a10; font-weight:900; box-shadow:0 0 14px #f2c56a; }

  .controls{ display:flex; gap:8px; }
  .btn{
    padding:8px 14px; border-radius:10px; border:2px solid #7a5525;
    background:linear-gradient(#f1c97a,#e7b85f); color:#2c1a32; font-weight:800;
  }
  .btn:disabled{ opacity:.6; cursor:not-allowed; }

  #turnInfo{ margin:4px 0 6px; color:#ffda8b; font-weight:800; }

  .board {
    position:relative; width:100%; flex:1;
    margin:20px 0; border-radius:16px;
    background:#1f1521;
    box-shadow:0 8px 24px rgba(0,0,0,.35), inset 0 0 18px rgba(0,0,0,.35);
    overflow:hidden; cursor:grab;
  }
  .board.grabbing{ cursor:grabbing; }
  .chain{ position:relative; width:100%; height:100%; }
  #chainZoom{ position:absolute; inset:0; transform-origin:0 0; }

  .tile{
    width:200px; height:70px;
    background:linear-gradient(#fffdf8,#fff6e7);
    border:2px solid #e7dbc9; border-radius:12px;
    display:grid; grid-template-columns:1fr 1fr;
    position:absolute;
    box-shadow:0 2px 6px rgba(0,0,0,.35), inset 0 0 0 2px #e0d3bd;
    overflow:hidden; user-select:none;
    transition:transform .12s;
  }
  .tile:hover{ transform:scale(1.04); }
  .tile .half{ display:flex; align-items:center; justify-content:center; padding:0 8px; }
  .tile .half:first-child{ border-right:2px solid #d8c8aa; }
  .tile b{ font-weight:900; color:#1c1712; }

  .tile.hand{ transform:scale(.65); cursor:grab; }

  .hands{ width:100%; display:flex; flex-direction:column; gap:10px; padding:10px 0 20px; }
  .hand-header{ text-align:center; font-weight:900; color:#e9d2a2; }
  .tray{
    width:100%; height:60px; display:flex; gap:8px; align-items:center;
    overflow-x:auto; padding:8px 10px;
    border:2px solid #8c5c2f; background:#5a3b21; border-radius:12px;
  }

  .final-overlay{ position:absolute; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index:100000; }
  .final-message{ font-size:42px; font-weight:900; color:#ffe97f; }
</style>
</head>
<body>

<div id="stage">
  <h1 id="title">Domino ¬∑ Classic</h1>

  <div id="menu" class="menu">
    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤: <input type="number" id="playerCount" min="2" max="4" value="2"></label>
    <div id="nameInputs"></div>
    <button id="startBtn" type="button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>

  <div class="topbar">
    <div id="playersBar" class="players"></div>
    <div class="controls">
      <button id="drawBtn" class="btn">–í–∑—è—Ç—å</button>
      <button id="skipBtn" class="btn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      <button id="restartBtn" class="btn">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
  </div>
  <div id="turnInfo"></div>

  <div class="board" id="board">
    <div class="chain" id="chain"><div id="chainZoom"></div></div>
  </div>

  <div class="hands">
    <div id="handHeader" class="hand-header"></div>
    <div id="tray" class="tray"></div>
  </div>

  <div id="finalOverlay" class="final-overlay">
    <div class="final-message">üéâ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <span id="winnerName"></span> üéâ</div>
  </div>
</div>

<script>
/* ===========================================================================================
   Utils & State
=========================================================================================== */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
function uid(){ return Math.random().toString(36).slice(2,9); }

const TILE_W=200, TILE_H=70;
let playerNames=[], hands={}, deck=[], currentPlayer=0, passes={};
let openLeft=null, openRight=null;

/* ===========================================================================================
   Deck
=========================================================================================== */
function makeDefaultDeck(){
  const F=["–∫–æ—Ç","–ø—ë—Å","–ª—É–Ω–∞","—Å–æ–ª–Ω—Ü–µ","–∑–≤–µ–∑–¥–∞","–º–æ—Å—Ç","—Ä–µ–∫–∞","–¥–æ–º","–ª–µ—Å","–º–æ—Ä–µ","—Å–∞–º–æ–ª—ë—Ç"];
  const out=[];
  for(let i=0;i<F.length;i++){
    for(let j=i;j<F.length;j++){
      out.push({ a:i, b:j, displayA:F[i], displayB:F[j], uid:uid() });
    }
  }
  return out;
}

/* ===========================================================================================
   Rendering
=========================================================================================== */
function createTileEl(a,b,opts={}){
  const el=document.createElement('div');
  el.className='tile '+(opts.role==='hand'?'hand':'');
  el.style.left=(opts.left||0)+'px';
  el.style.top=(opts.top||0)+'px';
  el.innerHTML='<div class="half"><b>'+ (opts.displayA||a) +'</b></div><div class="half"><b>'+ (opts.displayB||b) +'</b></div>';
  return el;
}

function renderPlayersBar(){
  const bar=document.getElementById('playersBar');
  bar.innerHTML='';
  for(let i=0;i<playerNames.length;i++){
    const el=document.createElement('div');
    el.className='player'+(i===currentPlayer?' active':'');
    el.textContent=playerNames[i];
    bar.appendChild(el);
  }
}

function renderHand(){
  const tray=document.getElementById('tray');
  tray.innerHTML='';
  const hand=hands[currentPlayer]||[];
  document.getElementById('handHeader').textContent=`${playerNames[currentPlayer]}: (${hand.length} –∫–æ—Å—Ç—è—à–µ–∫)`;
  for(const t of hand){
    const el=createTileEl(t.a,t.b,{ role:'hand', displayA:t.displayA, displayB:t.displayB });
    tray.appendChild(el);
  }
}

function updateControls(){
  [...document.getElementById('playersBar').getElementsByClassName('player')]
    .forEach((n,idx)=>n.classList.toggle('active',idx===currentPlayer));
  document.getElementById('turnInfo').textContent = `–•–æ–¥: ${playerNames[currentPlayer]}`;
  drawBtn.disabled = deck.length === 0;          // üî• –í–∑—è—Ç—å –º–æ–∂–Ω–æ –≤—Å–µ–≥–¥–∞, –ø–æ–∫–∞ –µ—Å—Ç—å –∫–æ–ª–æ–¥–∞
  skipBtn.disabled = deck.length > 0;            // üî• –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–ª–æ–¥–∞ –ø—É—Å—Ç–∞
}

/* ===========================================================================================
   Game flow
=========================================================================================== */
function startGame(){
  const n=Math.max(2,Math.min(4,parseInt(document.getElementById('playerCount').value)||2));
  playerNames=[];
  for(let i=0;i<n;i++){
    playerNames.push((document.getElementById('pname'+i)?.value||'').trim()||('–ò–≥—Ä–æ–∫ '+(i+1)));
  }
  deck=makeDefaultDeck(); shuffle(deck);
  hands={}; passes={}; currentPlayer=0;
  for(let i=0;i<n;i++){ hands[i]=[]; passes[i]=0; }
  for(let r=0;r<7;r++){ for(let i=0;i<n;i++){ if(deck.length) hands[i].push(deck.shift()); } }
  const start=deck.shift();
  document.getElementById('chainZoom').innerHTML='';
  const startTile=createTileEl(start.a,start.b,{ left:300, top:200, displayA:start.displayA, displayB:start.displayB });
  document.getElementById('chainZoom').appendChild(startTile);
  openLeft=start.a; openRight=start.b;
  renderPlayersBar(); renderHand(); updateControls();
  document.getElementById('menu').style.display='none';
}

function nextPlayer(){ currentPlayer=(currentPlayer+1)%playerNames.length; renderPlayersBar(); renderHand(); updateControls(); }
function everyonePassed(){ return Object.values(passes).every(v=>v>0); }
function endByWinner(i){ document.getElementById('winnerName').textContent=playerNames[i]; document.getElementById('finalOverlay').style.display='flex'; }
function endByPoints(){ let best=Infinity, wi=0; for(let i=0;i<playerNames.length;i++){ const s=(hands[i]||[]).length; if(s<best){ best=s; wi=i; } } endByWinner(wi); }

/* ===========================================================================================
   Events
=========================================================================================== */
drawBtn.addEventListener('click', ()=>{ if(deck.length){ hands[currentPlayer].push(deck.shift()); renderHand(); updateControls(); } });
skipBtn.addEventListener('click', ()=>{ passes[currentPlayer]=(passes[currentPlayer]||0)+1; if(everyonePassed()){ endByPoints(); return; } nextPlayer(); });
restartBtn.addEventListener('click', ()=>location.reload());
startBtn.addEventListener('click', startGame);
</script>
</body>
</html>
