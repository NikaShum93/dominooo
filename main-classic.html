<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Domino ¬∑ Classic (1 —Å–ø–∏—Å–æ–∫)</title>
<style>
  :root{
    --accent:#e6a8ff; --accent2:#ffda8b;
    --seat-fs:14px;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font:500 16px Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
    color:#fdf4ff; background:#2c1a32; overflow:hidden;
    display:flex; align-items:center; justify-content:center;
  }
  #stage{
    position:relative; width:960px; height:540px;
    display:flex; flex-direction:column; align-items:center;
    background:#2c1a32; border-radius:12px;
  }
  h1{margin:8px 0 6px; font-size:22px; font-weight:900; color:#ffda8b}

  .topbar{width:95%; display:flex; align-items:center; justify-content:space-between; gap:10px}
  .players{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .player{padding:6px 10px; border-radius:12px; background:rgba(230,168,255,.15); font-size:12px}
  .player.active{background:#ffda8b; color:#2c1a32; font-weight:900; box-shadow:0 0 12px #ffda8b}
  .controls{display:flex; gap:8px}
  .btn{padding:8px 14px; border-radius:10px; border:2px solid #7a5525; background:linear-gradient(#f1c97a,#e7b85f); color:#2c1a32; font-weight:800}
  .btn:disabled{opacity:.6; cursor:not-allowed}
  #turnInfo{margin:4px 0 2px; font-size:14px; color:#ffda8b; font-weight:800}

  .board{
    position:relative; width:95%; height:68%; margin:6px 0;
    background:#402b46; border-radius:18px; overflow:hidden; cursor:grab;
    box-shadow:inset 0 0 18px rgba(0,0,0,.35);
  }
  .board.grabbing{cursor:grabbing}
  .chain{position:relative; width:100%; height:100%}
  #chainZoom{position:absolute; inset:0; transform-origin:0 0;}

  .tile{
    width:200px; height:70px;
    background:linear-gradient(#fffdf8,#fff6e7);
    border:2px solid #e7dbc9; border-radius:12px; display:grid; grid-template-columns:1fr 1fr;
    position:absolute; box-shadow:0 2px 6px rgba(0,0,0,.35);
    overflow:hidden; user-select:none; transition:transform .12s;
  }
  .tile.vert{width:70px; height:200px; grid-template-columns:1fr; grid-template-rows:1fr 1fr}
  .tile .half{display:flex; align-items:center; justify-content:center; padding:0 8px; overflow:hidden; min-width:0}
  .tile .half:first-child { border-right: 2px solid #d8c8aa; }
  .tile.vert .half:first-child { border-right: none; border-bottom: 2px solid #d8c8aa; }
  .tile b{font-weight:900; color:#1c1712; white-space:nowrap;}

  .hands{width:100%; display:flex; flex-direction:column; gap:6px; padding:8px 0}
  .hand-header{width:95%; margin:0 auto; text-align:center; font-weight:900; color:#e9d2a2}
  .tray{width:95%; margin:0 auto; height:60px; display:flex; gap:8px; flex-wrap:nowrap; align-items:center; overflow-x:auto; padding:8px 10px; border:2px solid #8c5c2f; background:#5a3b21; border-radius:12px}
  .tray > .tile{position:static} .tile.hand{transform:scale(.50); transform-origin:left center; cursor:grab; filter:drop-shadow(0 1px 1px rgba(0,0,0,.25))}
  .tile.hand *{pointer-events:none}

  /* –°—Ç—Ä–µ–ª–∫–∏-–∑–æ–Ω—ã */
  .dz{position:absolute; width:38px; height:38px; border:2px dashed #ffda8b; border-radius:10px; display:none; background:rgba(255,218,139,.1)}
  .dz.active{display:block; background:rgba(255,218,139,.25); box-shadow:0 0 12px rgba(255,218,139,.6)}
  .dz::after{content:attr(data-dir); font-size:12px; color:#2c1a32; font-weight:900; background:#ffda8b; padding:2px 6px; border-radius:8px; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%)}

  /* –ú–µ–Ω—é —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ */
  .menu{
    position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px;
    padding:30px; z-index:100000;
    background:linear-gradient(rgba(44,26,50,.92), rgba(44,26,50,.94)); border-radius:12px;
  }
  .menu label{color:#f2d39a; font-weight:800}
  .menu input{padding:8px 12px; width:220px; border-radius:8px; border:2px solid #8c5c2f; background:#fff6e7; color:#2b1a10; margin-top:4px}
  .menu button{padding:10px 16px; border-radius:10px; border:2px solid #7a5525; font-weight:900; cursor:pointer; background:linear-gradient(#f1c97a,#e7b85f); color:#2b1a10}

  /* –ü–æ–±–µ–¥–∏—Ç–µ–ª—å */
  .final-overlay {position:absolute; inset:0; background:rgba(0,0,0,0.7); display:none; align-items:center; justify-content:center; z-index:200000;}
  .final-message {font-size:40px; font-weight:900; color:#ffe97f;}
</style>
</head>
<body>
<div id="stage">
  <h1 id="title">Domino ¬∑ Classic (1 —Å–ø–∏—Å–æ–∫)</h1>

  <!-- –ú–µ–Ω—é -->
  <div id="menu" class="menu">
    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:
      <input type="number" id="playerCount" min="2" max="4" value="2">
    </label>
    <div id="nameInputs"></div>
    <button id="startBtn" type="button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>

  <div class="topbar">
    <div id="playersBar" class="players"></div>
    <div class="controls">
      <button id="drawBtn" class="btn">–í–∑—è—Ç—å</button>
      <button id="skipBtn" class="btn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      <button id="restartBtn" class="btn">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
  </div>
  <div id="turnInfo"></div>

  <!-- –ü–æ–ª–µ -->
  <div class="board" id="board">
    <div class="chain" id="chain">
      <div id="chainZoom"></div>
    </div>
  </div>

  <!-- –†—É–∫–∏ -->
  <div class="hands">
    <div id="handHeader" class="hand-header"></div>
    <div id="tray" class="tray"></div>
  </div>

  <!-- –ü–æ–±–µ–¥–∏—Ç–µ–ª—å -->
  <div id="finalOverlay" class="final-overlay">
    <div class="final-message">üéâ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <span id="winnerName"></span> üéâ</div>
  </div>
</div>

<script>
/* ===== –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≥–µ–æ–º–µ—Ç—Ä–∏–∏ ===== */
const TILE_W=200, TILE_H=70, VERT_W=70, VERT_H=200, GAP=4, DZ=38;

/* ===== DOM refs ===== */
const menuEl=document.getElementById('menu');
const playerCountEl=document.getElementById('playerCount');
const nameInputsEl=document.getElementById('nameInputs');
const playersBarEl=document.getElementById('playersBar');
const boardEl=document.getElementById('board');
const chainEl=document.getElementById('chain');
const chainZoom=document.getElementById('chainZoom');
const handHeader=document.getElementById('handHeader');
const trayEl=document.getElementById('tray');
const drawBtn=document.getElementById('drawBtn');
const skipBtn=document.getElementById('skipBtn');
const restartBtn=document.getElementById('restartBtn');
const turnInfo=document.getElementById('turnInfo');

/* ===== –°–æ—Å—Ç–æ—è–Ω–∏–µ ===== */
let playerNames=[], hands={}, deck=[], currentPlayer=0, passes={};
let openLeft=null, openRight=null, endLeft=null, endRight=null, dragging=null;

/* ===== –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ ===== */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}
function uid(i){return't'+i+'_'+Math.random().toString(36).slice(2,7);}
function br(){return{w:chainEl.clientWidth,h:chainEl.clientHeight};}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function getQueryData(){
  const raw=new URLSearchParams(location.search).get('data'); if(!raw) return null;
  try{return JSON.parse(decodeURIComponent(raw));}catch(e){return null;}
}

/* ===== –ú–µ–Ω—é: –ø–æ–ª—è –∏–º—ë–Ω ===== */
function renderNameInputs(){
  nameInputsEl.innerHTML='';
  const n=parseInt(playerCountEl.value,10)||2;
  for(let i=0;i<n;i++){
    const inp=document.createElement('input');
    inp.placeholder='–ò–º—è –∏–≥—Ä–æ–∫–∞ '+(i+1);
    inp.id='pname'+i;
    nameInputsEl.appendChild(inp);
  }
}
playerCountEl.addEventListener('input',renderNameInputs); renderNameInputs();

/* ===== –ü–∞–Ω/–∑—É–º –ø–æ –ø–æ–ª—é (–ø—Ä–æ—Å—Ç–µ–Ω—å–∫–æ) ===== */
let scale=1, panX=0, panY=0, isPanning=false, startPanX=0, startPanY=0;
function updateTransform(){ chainZoom.style.transform=`translate(${panX}px, ${panY}px) scale(${scale})`; }
boardEl.addEventListener('mousedown',e=>{ if(e.button!==0 || e.target.closest('.dz, .tile')) return; e.preventDefault(); isPanning=true; startPanX=e.clientX-panX; startPanY=e.clientY-panY; boardEl.classList.add('grabbing'); });
window.addEventListener('mousemove',e=>{ if(!isPanning) return; e.preventDefault(); panX=e.clientX-startPanX; panY=e.clientY-startPanY; updateTransform();});
window.addEventListener('mouseup',()=>{ if(isPanning){ isPanning=false; boardEl.classList.remove('grabbing'); }});
boardEl.addEventListener('wheel',e=>{ e.preventDefault(); const rect=boardEl.getBoundingClientRect(); const mx=e.clientX-rect.left, my=e.clientY-rect.top; const k=1 - e.deltaY*0.001; const ns=clamp(scale*k, 0.3, 2.5); panX=mx - (mx-panX)*(ns/scale); panY=my - (my-panY)*(ns/scale); scale=ns; updateTransform(); });

/* ===== –ö–æ—Å—Ç—è—à–∫–∞ DOM ===== */
function createTileEl(a,b,opts={}){
  const role=opts.role||'chain'; const owner=Number.isInteger(opts.owner)?opts.owner:null; const id=opts.uid||null; const orient=opts.orient||'h'; const draggable=!!opts.draggable;
  const el=document.createElement('div'); el.className='tile '+(orient==='v'?'vert ':'')+role;
  el.dataset.a=a; el.dataset.b=b; if(id) el.dataset.uid=id; if(owner!==null) el.dataset.owner=owner;
  if(opts.left!==undefined){ el.style.left=opts.left+'px'; el.style.top=opts.top+'px'; }
  el.innerHTML='<div class="half"><b></b></div><div class="half"><b></b></div>';
  const h=el.getElementsByClassName('half');
  h[0].firstElementChild.textContent=a; h[1].firstElementChild.textContent=b;

  if(draggable){
    el.draggable=true;
    el.addEventListener('dragstart',e=>{ dragging={a,b,uid:id,owner}; e.dataTransfer.setData('text/plain','domino'); renderDirectionalZones(); });
    el.addEventListener('dragend',()=>{ dragging=null; clearZones(); });
  }
  return el;
}

/* ===== –†–∞–∑–¥–∞—á–∞/—Ä—É–∫–∞ ===== */
function renderHand(){
  const hand=hands[currentPlayer]||[];
  handHeader.textContent=`${playerNames[currentPlayer]}: (${hand.length} –∫–æ—Å—Ç—è—à–µ–∫)`;
  trayEl.innerHTML='';
  for(const t of hand){
    trayEl.appendChild(createTileEl(t.a,t.b,{role:'hand',owner:currentPlayer,uid:t.uid,draggable:true,orient:'h'}));
  }
}
function renderPlayersBar(){
  playersBarEl.innerHTML='';
  for(let i=0;i<playerNames.length;i++){
    const el=document.createElement('div');
    el.className='player'+(i===currentPlayer?' active':'');
    el.textContent=playerNames[i];
    playersBarEl.appendChild(el);
  }
}
function updateControls(){
  const playable=hasPlayable(hands[currentPlayer]||[]);
  drawBtn.disabled=(playable)||deck.length===0;
  turnInfo.textContent=`–•–æ–¥: ${playerNames[currentPlayer]}`;
}

/* ===== –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–æ–¥–æ–≤ (–∫–ª–∞—Å—Å–∏–∫–∞) ===== */
function hasPlayable(hand){
  for(const t of hand){
    if (t.a===openLeft || t.b===openLeft || t.a===openRight || t.b===openRight) return true;
  }
  return false;
}

/* ===== –ì–µ–æ–º–µ—Ç—Ä–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è ===== */
function getSeam(end){
  if(end.orient==='h'){
    return end.dir===1? {x:end.x+TILE_W, y:end.y+TILE_H/2} : {x:end.x, y:end.y+TILE_H/2};
  } else {
    return end.dir===1? {x:end.x+VERT_W/2, y:end.y+VERT_H} : {x:end.x+VERT_W/2, y:end.y};
  }
}
function getNextPos(end,choice){
  let x,y,orient,nextDir;
  if(end.orient==='h'){
    const seamX=end.dir===1? end.x+TILE_W : end.x; const ay=end.y;
    switch(choice){
      case 'right': x=seamX+GAP; y=ay; orient='h'; nextDir=1; break;
      case 'left':  x=seamX-TILE_W-GAP; y=ay; orient='h'; nextDir=-1; break;
      case 'down':  x=(end.dir===1? seamX-VERT_W : seamX); y=ay+TILE_H+GAP; orient='v'; nextDir=1; break;
      case 'up':    x=(end.dir===1? seamX-VERT_W : seamX); y=ay-VERT_H-GAP; orient='v'; nextDir=-1; break;
    }
  } else {
    const seamY=end.dir===1? end.y+VERT_H : end.y; const ax=end.x;
    switch(choice){
      case 'up':    x=ax; y=seamY-VERT_H-GAP; orient='v'; nextDir=-1; break;
      case 'down':  x=ax; y=seamY+GAP; orient='v'; nextDir=1; break;
      case 'right': x=ax+VERT_W+GAP; y=(end.dir===1? seamY-TILE_H : seamY); orient='h'; nextDir=1; break;
      case 'left':  x=ax-TILE_W-GAP; y=(end.dir===1? seamY-TILE_H : seamY); orient='h'; nextDir=-1; break;
    }
  }
  return {x,y,orient,nextDir};
}
function rectOf(o,x,y){return{x,y,w:o==='v'?VERT_W:TILE_W,h:o==='v'?VERT_H:TILE_H}}
function intersects(r1,r2){return !(r2.x>=r1.x+r1.w||r2.x+r2.w<=r1.x||r2.y>=r1.y+r1.h||r2.y+r2.h<=r1.y)}
function collidesWithExisting(r){
  for(const t of [...chainZoom.querySelectorAll('.tile:not(.hand)')]){
    const w=t.classList.contains('vert')?VERT_W:TILE_W;
    const h=t.classList.contains('vert')?VERT_H:TILE_H;
    const r2={x:parseInt(t.style.left||0),y:parseInt(t.style.top||0),w,h};
    if(intersects(r,r2)) return true;
  }
  return false;
}
function applyPlaced(end,pos){ end.x=pos.x; end.y=pos.y; end.orient=pos.orient; end.dir=pos.nextDir; }

/* ===== –ó–æ–Ω—ã-—Å—Ç—Ä–µ–ª–∫–∏ ===== */
function clearZones(){[...chainZoom.querySelectorAll('.dz')].forEach(n=>n.remove());}
function renderDirectionalZones(){
  clearZones(); if(!dragging) return;
  const ends=[{e:endLeft,id:'L',open:openLeft},{e:endRight,id:'R',open:openRight}];
  for(const side of ends){
    if(!side.e || !side.e.el) continue;
    // –¥–æ–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ—Å—Ç—å –≤–æ–æ–±—â–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ —Å–ª–æ–≤—É
    if(!(dragging.a===side.open || dragging.b===side.open)) continue;

    const seam=getSeam(side.e);
    const OFFSET=20;
    const zones={
      up:{ left:seam.x-DZ/2, top:seam.y-DZ-GAP-OFFSET, dir:'‚Üë', k:'up'},
      right:{ left:seam.x+GAP+OFFSET, top:seam.y-DZ/2, dir:'‚Üí', k:'right'},
      down:{ left:seam.x-DZ/2, top:seam.y+GAP+OFFSET, dir:'‚Üì', k:'down'},
      left:{ left:seam.x-DZ-GAP-OFFSET, top:seam.y-DZ/2, dir:'‚Üê', k:'left'}
    };
    for(const k of Object.keys(zones)){
      const pos=getNextPos(side.e,k); if(!pos.orient) continue;
      const r=rectOf(pos.orient,pos.x,pos.y); if(collidesWithExisting(r)) continue;
      const z=document.createElement('div'); z.className='dz active';
      z.style.left=zones[k].left+'px'; z.style.top=zones[k].top+'px';
      z.dataset.dir=zones[k].dir; z.dataset.end=side.id; z.dataset.k=k;
      chainZoom.appendChild(z);
    }
  }
}
addEventListener('resize',()=>{ if(dragging) renderDirectionalZones(); });

/* ===== –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Å—Ç–∏ ===== */
function placeAt(whichEnd, tileData, choice){
  const end=(whichEnd==='left')? endLeft : endRight;
  const pos=getNextPos(end,choice);
  if(!pos.orient || collidesWithExisting(rectOf(pos.orient,pos.x,pos.y))) return false;

  const newTile=createTileEl(tileData.a,tileData.b,{orient:pos.orient,left:pos.x,top:pos.y});
  chainZoom.appendChild(newTile);
  applyPlaced(end,pos);
  end.el=newTile;
  return true;
}
function tryPlace(target,data){
  if(!data || !target.classList.contains('dz')) return false;
  const isLeft=target.dataset.end==='L';
  const choice=target.dataset.k;
  const endOpen=isLeft? openLeft : openRight;

  // –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Å–ª–æ–≤—É
  let p1,p2,ok=false;
  if(data.a===endOpen){ p1=data.a; p2=data.b; ok=true; }
  else if(data.b===endOpen){ p1=data.b; p2=data.a; ok=true; }
  if(!ok) return false;

  if(placeAt(isLeft?'left':'right',{a:p1,b:p2},choice)){
    if(isLeft) openLeft=p2; else openRight=p2;
    return true;
  }
  return false;
}

/* ===== –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ —Ü–µ–ø–æ—á–∫—É ===== */
function fitChain(){
  const tiles=[...chainZoom.querySelectorAll('.tile:not(.hand)')]; if(!tiles.length){ scale=1; panX=panY=0; updateTransform(); return; }
  let minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity;
  for(const t of tiles){
    const x=parseInt(t.style.left||0), y=parseInt(t.style.top||0);
    const w=t.classList.contains('vert')?VERT_W:TILE_W;
    const h=t.classList.contains('vert')?VERT_H:TILE_H;
    minX=Math.min(minX,x); minY=Math.min(minY,y); maxX=Math.max(maxX,x+w); maxY=Math.max(maxY,y+h);
  }
  const pad=30; const bw=br().w, bh=br().h;
  const s=Math.min(1,(bw-pad)/(maxX-minX),(bh-pad)/(maxY-minY));
  scale=s; panX=(bw-(maxX-minX)*s)/2 - minX*s; panY=(bh-(maxY-minY)*s)/2 - minY*s; updateTransform();
}

/* ===== –ö–æ–ª–æ–¥–∞ (1 —Å–ø–∏—Å–æ–∫) ===== */
function buildDeckFromData(d){
  const out=[]; const A=(d && Array.isArray(d.listA))? d.listA : [];
  const src=A.length? A : ["–∫–æ—Ç","–ø—ë—Å","–ª—É–Ω–∞","—Å–æ–ª–Ω—Ü–µ","–∑–≤–µ–∑–¥–∞","–º–æ—Å—Ç","—Ä–µ–∫–∞","–¥–æ–º"];
  for(let i=0;i<src.length;i++){
    for(let j=i;j<src.length;j++){
      out.push({a:src[i], b:src[j], uid:uid(i+'_'+j)});
    }
  }
  return out;
}

/* ===== –ò–≥—Ä–∞ ===== */
function award(i,pts=1){ /* –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –æ—á–∫–∏ ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å */ }
function nextPlayer(){ currentPlayer=(currentPlayer+1)%playerNames.length; renderPlayersBar(); renderHand(); updateControls(); }
function everyonePassed(){ for(let i=0;i<playerNames.length;i++){ if(!(passes[i]>0)) return false; } return true; }
function endByWinner(i){
  document.getElementById('winnerName').textContent=playerNames[i];
  document.getElementById('finalOverlay').style.display='flex';
}

/* ===== –°—Ç–∞—Ä—Ç ===== */
function startGame(){
  const data=getQueryData()||{};
  playerNames.length=0;
  const c=Math.max(2,Math.min(4,parseInt(playerCountEl.value)||2));
  for(let i=0;i<c;i++){
    playerNames.push((document.getElementById('pname'+i)?.value||'').trim()||('–ò–≥—Ä–æ–∫ '+(i+1)));
  }

  deck=buildDeckFromData(data);
  shuffle(deck);

  hands={}; passes={}; currentPlayer=0;
  for(let k=0;k<c;k++){ hands[k]=[]; passes[k]=0; }

  // –†–∞–∑–¥–∞—á–∞ –ø–æ 5
  for(let r=0;r<5;r++){
    for(let j=0;j<c;j++){
      if(!deck.length) break;
      hands[j].push(deck.shift());
    }
  }

  // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∫–æ—Å—Ç—å
  let start=deck.shift();
  if(!start){ const h=hands[0]||[]; start = h.length? h.shift() : {a:"Start", b:"Start", uid:uid('S')}; hands[0]=h; }

  chainZoom.innerHTML='';
  const sx=Math.floor((br().w-TILE_W)/2), sy=Math.floor((br().h-TILE_H)/2);
  const startTile=createTileEl(start.a,start.b,{left:sx,top:sy});
  chainZoom.appendChild(startTile);

  openLeft=start.a; openRight=start.b;
  endLeft ={x:sx,y:sy,dir:-1,orient:'h',el:startTile};
  endRight={x:sx,y:sy,dir: 1,orient:'h',el:startTile};

  fitChain();
  renderPlayersBar();
  renderHand();
  updateControls();
  menuEl.style.display='none';
}

/* ===== –ö–Ω–æ–ø–∫–∏ ===== */
drawBtn.addEventListener('click',()=>{
  const hand=hands[currentPlayer]||[];
  if(hasPlayable(hand) || !deck.length) return;
  hand.push(deck.splice(Math.floor(Math.random()*deck.length),1)[0]);
  hands[currentPlayer]=hand;
  renderHand(); updateControls();
});
skipBtn.addEventListener('click',()=>{
  passes[currentPlayer]=(passes[currentPlayer]||0)+1;
  if(everyonePassed()){ // –ø–æ-–ø—Ä–æ—Å—Ç–æ–º—É: –ø–æ–±–µ–¥–∞ –ø–æ –Ω–∞–∏–º–µ–Ω—å—à–µ–º—É —á–∏—Å–ª—É –∫–æ—Å—Ç—è—à–µ–∫
    let wi=0, best=Infinity;
    for(let i=0;i<playerNames.length;i++){
      const len=(hands[i]||[]).length;
      if(len<best){best=len; wi=i;}
    }
    endByWinner(wi); return;
  }
  nextPlayer();
});
restartBtn.addEventListener('click',()=>location.reload());
document.getElementById('startBtn').addEventListener('click',startGame);

/* ===== DnD –Ω–∞ –ø–æ–ª–µ ===== */
addEventListener('dragover',e=>{ if(dragging) e.preventDefault(); });
addEventListener('drop',e=>{
  const t=e.target;
  if(!dragging) return;
  if(t && t.classList && t.classList.contains('dz')){
    e.preventDefault();
    const ok=tryPlace(t,dragging);
    if(ok){
      const arr=hands[dragging.owner]||[];
      hands[dragging.owner]=arr.filter(x=>x.uid!==dragging.uid);
      renderHand();
      if(hands[dragging.owner].length===0){
        endByWinner(dragging.owner); dragging=null; clearZones(); return;
      }
      passes[currentPlayer]=0;
      nextPlayer();
    }
    dragging=null; clearZones();
  }
});

/* ===== –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª —Ä—É–∫–∏ –∫–æ–ª–µ—Å–æ–º ===== */
trayEl.addEventListener('wheel',e=>{ trayEl.scrollLeft+=e.deltaY },{passive:true});

/* ===== Init ===== */
(function(){ if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded',()=>{}); }})();
</script>
</body>
</html>
